---
title: "svm"
author: "Carolina Cornejo Castellano"
date: '`r Sys.Date()`'
output: pdf_document
---

# Libraries

```{r message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(caret) # for machine learning
library(naniar) # for better handling NA
library(fastDummies) # for 'dummifying' categorical variables
library(factoextra)
library(ROCR) #for plotting AUC
library(janitor) # for standardizing column names
library(MASS)
library(e1071)
library(pROC)
library(kernlab) # ksvm
library(doParallel) # for parallel programming
```

# Sourcing 2017 data and cleaning

```{r this is the training data}
source("cleaning_2017.R")
```

# Sourcing 2018 data and cleaning

```{r this is test data}
source("cleaning_2018.R")
```

# Sourcing 2016 data and cleaning

Following the recommendations of one of our lecturers, we tested the ksvm model of the `kernlab` package with other data, because the predictions on 2018 data were too good. So, we chose 2016 data.

```{r sourcing 2016 data to take it as a second test data}
source("cleaning_2016.R")
```

# SVM model

```{r fit and summarize model}
ksvm_model <- ksvm(unem~., 
                   data = df_dummified_2017,
                   prob.model = TRUE)
# summarize the fit
print(ksvm_model)
```

```{r}
ksvm_predictions_2018 <- predict(ksvm_model, 
                                 newdata = df_dummified_2018)
```

```{r}
conf_matrix_2018 <- table(df_dummified_2018$unem, ksvm_predictions_2018)
conf_matrix_2018
```

```{r}
accuracy <- sum(diag(conf_matrix_2018))/sum(conf_matrix_2018)
precision <- conf_matrix_2018[2, 2]/sum(conf_matrix_2018[, 2])
recall <- conf_matrix_2018[2, 2]/sum(conf_matrix_2018[2, ])
specificity <- conf_matrix_2018[1, 1]/sum(conf_matrix_2018[1, ])

accuracy
precision
recall
specificity
```

```{r}
# AUC
ksvm_predictions_2018_prob <- predict(ksvm_model, 
                                      newdata = df_dummified_2018,
                                      type = "prob")

ksvm_predictions_2018_prob <- ksvm_predictions_2018_prob[, 2]



auc_2018
```

```{r}
auc_2018 <- roc(df_dummified_2018$unem, ksvm_predictions_2018_prob)
auc_2018
```

```{r}
```